# Проект: ["Донорская справка"](https://github.com/maresin/some_projects/blob/main/Form405_OCR/donor_ocr_notebook.ipynb)
__Задача:__  
Распознать содержание справки о сдаче крови для социальной сети доноров _DonorSearch_.  

__Данные:__  
Исходные данные для проекта представляют собой фотографии учетных карточек доноров крови. Все они однотипные и заполнены по  _Форме № 405-05/у,_ утвержденной Утверждена приказом Минздравсоцразвития России от 31 марта 2005 г. №246. Кроме того имеются  csv-файлы с данными для уже обработанных карточек.

__Сделано:__  
В процессе работы над проектом были рассмотрены несколько вариантов подходов к решению задачи распознавания текста. Основной заключался в том, чтобы сначала определить структуру таблицы с записями, а затем распознать текст в ее ячейках. Однако, множественные и разнотипные геометрические искажения на изображениях этого сделать не позволили. Изображения решено было распознавать "как есть" с помощью программы _EasyOCR_, а затем парсить пространственные метки, которые она выдавала. Такой подход дал достаточно качественные результаты.  
Само решение было реализовано в виде класса `class_form405` и оформлено в виде скриптов. Была попытка создать приложение на основе _docker_-образа, но файлы с моделями передать в программу _EasyOCR_ не удалось.  

Был реализован дополнительный функционал:
- при запуске стартового скрипта предусмотрена возможность выбора распознавания одиночного файла или всех нераспознанных файлов;
- также присутствует возможность немедленного или отложенного запуска нераспознанных файлов;
- распознавание отдельных файлов выполняется асинхронно;
- предусмотрено сохранение логов обработки в рабочей директории.


__Инструкция по использованию:__  
Предполагается, что файлы с фотографиями справок будут храниться в директории `/resources` вместе с файлами `class_form405.py` и `ocr.py`. Перед началом сканирования необходимо создать рабочую папку с этими файлами и папкой для хранения. Для сканирования можно воспользоваться командной строкой Windows:
* нажать` Win+R`;
* ввести `cmd`;
* перейти в рабочую директорию - `сd <my_path/my_dir>`;
* запустить файл скрипта - `python start_ocr.py`;
* если Python устанавливался с помощью Anaconda, возможно в переменных средах придётся прописать путь к файлу `python.exe`;
* после приглашения ввести имя файла изображения;
* файл с распознанными данными в виде csv-файла будет сохранён в директории `/resources`;
* при первом запуске скрипта должны загрузиться файлы модели `cyrillic_g2.pth` и `craft_mlt_25k.pth`([можно взять отсюда](https://drive.google.com/file/d/10XZjccbG53hgLTqGCoyjRToD4Cfa-EQV/view?usp=sharing)). В Windows они будут сохранены в папку `c:\Users\<Имя пользователя>\.EasyOCR\model\`. 


__Благодарности:__
Получено [Благодарственное письмо](https://github.com/maresin/some_projects/blob/main/Form405_OCR/thanksgiving_letter.pdf) за участие в разработке от заказчика проекта.
